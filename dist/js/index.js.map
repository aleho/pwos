{"version":3,"sources":["vars.js","database.js","pwos.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["var PWOS_VERSION = 1515020997;\nvar PWOS_DATE = '20180104_000957';\n\nif (typeof window === 'undefined') {\n    exports.PWOS_VERSION = PWOS_VERSION;\n    exports.PWOS_DATE    = PWOS_DATE;\n}\n","var PWoSDb = (function () {\n    let Db = function (data) {\n        this.data = data;\n    };\n\n    Db.prototype.filter = function* (filter) {\n        filter = filter || {};\n\n        let fTitle = filter.title ? new RegExp(filter.title, 'i') : null;\n        let fUrl   = filter.url   ? new RegExp(filter.url, 'i')   : null;\n\n        for (let site of this.data) {\n            if (fTitle\n                && (!site.title || !site.title.match(fTitle))\n            ) {\n               continue;\n            }\n\n            if (fUrl\n                && (!site.url || !site.url.match(fUrl))\n            ) {\n               continue;\n            }\n\n            yield site;\n        }\n    };\n\n\n    let db = null;\n\n    function load(url) {\n        let deferred = $.Deferred();\n\n        if (!url) {\n            deferred.reject();\n            return deferred.promise();\n        }\n\n        $.ajax({\n            type:     'GET',\n            dataType: 'json',\n            url:      url\n\n        }).done(function (json) {\n            if (json) {\n                db = new Db(json);\n                deferred.resolve(db);\n            } else {\n                deferred.reject();\n            }\n\n        }).fail(function () {\n            db = null;\n            deferred.reject();\n        });\n\n        return deferred.promise();\n    }\n\n\n    return {\n        load: load\n    }\n})();\n","var PWoS = (function ($) {\n    const MIN_LEN_BAD = 5;\n    const MAX_LEN_BAD = 16;\n\n    const DB_URL = 'data/db.json?ts=' + PWOS_VERSION;\n\n    const ATTRS = [\n        'alpha', 'digit', 'space', 'special', 'case', 'changeable'\n    ];\n\n    const $list     = $('#sites-list');\n    const $template = $('#site-template tr');\n    const $filters  = $('.filter');\n\n    let db;\n\n\n    function addRow(data) {\n        let $row = $template.clone().appendTo($list);;\n\n        $row.find('.title').text(data.title);\n        $row.find('a.url')\n            .text(data.url.replace(/^https?\\:\\/\\//i, ''))\n            .attr('href', data.url);\n\n        $row.find('.attr.min').text(data.pw.min).toggleClass('text-danger text-bold', data.pw.min <= MIN_LEN_BAD);\n        $row.find('.attr.max').text(data.pw.max).toggleClass('text-danger text-bold', data.pw.max <= MAX_LEN_BAD);\n\n        for (let attr of ATTRS) {\n            if (!data.pw[attr]) {\n                $row.find('.attr.' + attr + ' i').removeClass('invisible');\n            }\n        }\n    }\n\n    function filter($input) {\n        let attr = $input.data('filter');\n        let val  = $input.val();\n\n        if (!attr || (val.length < 2 && val.length != 0)) {\n            return;\n        }\n\n        let filter   = {};\n        filter[attr] = val;\n\n        showResults(filter);\n    }\n\n    function showResults(filter) {\n        filter = filter || null;\n\n        let result = db.filter(filter);\n        let site   = result.next();\n\n        $list.empty();\n        while (site && !site.done && site.value) {\n            addRow(site.value);\n            site = result.next();\n        }\n    }\n\n    function init() {\n        $('#last-update').text(new Date(PWOS_VERSION * 1000));\n\n        $('.filter').keypress(function (event) {\n            if (event.which == 13) {\n                filter($(this));\n            }\n        });\n\n        PWoSDb\n            .load(DB_URL)\n            .done(function (resultDb) {\n                db = resultDb;\n                showResults();\n            })\n            .fail(function () {\n                console.log('fail') //XXX TODO!\n            });\n    }\n\n    return {\n        init: init,\n\n        get db() {\n            return db;\n        }\n    };\n})(jQuery);\n"]}