{"version":3,"sources":["vars.js","scrollmonitor.js","titletouch.js","database.js","table.js","pwos.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["var PWOS_VERSION = 1515348207;\nvar PWOS_DATE = '20180107_190327';\n\nif (typeof window === 'undefined') {\n    exports.PWOS_VERSION = PWOS_VERSION;\n    exports.PWOS_DATE    = PWOS_DATE;\n}\n","var ScrollMonitor = function ($element) {\n    if (!$element) {\n        return;\n    }\n\n    this.uid      = ++ScrollMonitor.uid;\n    this.$element = $element;\n};\n\nScrollMonitor.uid = 0;\nScrollMonitor.prototype.isMonitoring = false;\nScrollMonitor.prototype.uid = 0;\nScrollMonitor.prototype.$element = null;\n\n\n/**\n * Checks whether out element is visible in the viewport.\n */\nScrollMonitor.prototype._isScrolledTo = function () {\n    let anchorTop    = this.$element.offset().top;\n    let screenBottom = $(window).scrollTop() + $(window).height();\n\n    return (screenBottom > anchorTop);\n};\n\n/**\n * Starts monitoring.\n */\nScrollMonitor.prototype.start = function () {\n    if (!this.uid || this.isMonitoring) {\n        return;\n    }\n\n    this.isMonitoring = true;\n\n    $(window).on('scroll.lazyload-' + this.uid, function () {\n        if (!this._isScrolledTo(this.$element)) {\n            return;\n        }\n\n        this.stop();\n        $(window).trigger('scrolled-to', [ this.$element, this ]);\n    }.bind(this));\n};\n\n/**\n * Stops all events related to lazy loading.\n */\nScrollMonitor.prototype.stop = function () {\n    if (!this.uid || !this.isMonitoring) {\n        return;\n    }\n\n    this.isMonitoring = false;\n    $(window).off('scroll.lazyload-' + this.uid);\n};\n","(function ($) {\n    let $last;\n\n    function hideTooltip($element) {\n        clearTimeout($element.data('tt-timeout'));\n\n        $element.data('tt-timeout', null);\n        $element.tooltip('dispose');\n    }\n\n    function showTooltip($element) {\n        if ($last) {\n            clearTimeout($last.data('tt-timeout'));\n            $last.data('tt-timeout', null);\n        }\n\n        if (!$element.is($last)) {\n            if ($last) {\n                $last.tooltip('dispose');\n            }\n\n            $element.tooltip('show');\n        }\n\n        $last = $element;\n\n        let timeout = setTimeout(function () {\n            clearTimeout($element.data('tt-timeout'));\n            $element.data('tt-timeout', null);\n            $element.tooltip('dispose');\n            $last = null;\n        }, 2000);\n\n        $element.data('tt-timeout', timeout);\n    }\n\n\n    // lazy touch-friendlyness\n    let hasTouch = ('ontouchstart' in document.documentElement);\n\n    if (hasTouch) {\n        $('body').addClass('hastouch');\n        $(document).on('touchend', '[title]', function () {\n            showTooltip($(this));\n        });\n    }\n\n})(jQuery);\n","var PWoSDb = (function () {\n    let Db = function (data) {\n        this.data = data;\n    };\n\n    Db.prototype.filter = function* (filter) {\n        filter = filter || {};\n\n        let fTitle = filter.title ? new RegExp(filter.title, 'i') : null;\n        let fUrl   = filter.url   ? new RegExp(filter.url, 'i')   : null;\n\n        for (let site of this.data) {\n            if (fTitle\n                && (!site.title || !site.title.match(fTitle))\n            ) {\n               continue;\n            }\n\n            if (fUrl\n                && (!site.url || !site.url.match(fUrl))\n            ) {\n               continue;\n            }\n\n            yield site;\n        }\n    };\n\n\n    let db = null;\n\n    function load(url) {\n        let deferred = $.Deferred();\n\n        if (!url) {\n            deferred.reject();\n            return deferred.promise();\n        }\n\n        $.ajax({\n            type:     'GET',\n            dataType: 'json',\n            url:      url\n\n        }).done(function (json) {\n            if (json) {\n                db = new Db(json);\n                deferred.resolve(db);\n            } else {\n                deferred.reject();\n            }\n\n        }).fail(function () {\n            db = null;\n            deferred.reject();\n        });\n\n        return deferred.promise();\n    }\n\n\n    return {\n        load: load\n    }\n})();\n","var Table = function ($element, $rowTemplate) {\n    if (!$element || !$rowTemplate) {\n        return;\n    }\n\n    this.$element     = $element;\n    this.$rowTemplate = $rowTemplate;\n};\n\nTable.MIN_LEN_BAD     = 5;\nTable.MAX_LEN_BAD     = 16;\nTable.SHAME_SCORE_BAD = 3;\nTable.ATTRS           = [\n    'alpha', 'digit', 'space', 'special', 'case', 'changeable'\n];\n\nTable.prototype.$element     = null;\nTable.prototype.$rowTemplate = null;\n\n\n/**\n * Empties the table.\n */\nTable.prototype.empty = function () {\n    this.$element.empty();\n};\n\n\n/**\n * Adds a row to the table.\n */\nTable.prototype.addRow = function (data) {\n    let $row       = this.$rowTemplate.clone().appendTo(this.$element);\n    let shameScore = 0;\n\n    $row.find('.title').text(data.title);\n\n    $row.find('a.url')\n        .attr('href', data.url)\n        .find('.url-text')\n        .text(data.url.replace(/^https?\\:\\/\\//i, ''));\n\n\n    $row.find('.attr.min')\n        .text(data.pw.min)\n        .toggleClass('text-danger', data.pw.min <= Table.MIN_LEN_BAD);\n\n    $row.find('.attr.max')\n        .text(data.pw.max)\n        .toggleClass('text-danger', data.pw.max <= Table.MAX_LEN_BAD);\n\n    if (data.pw.min <= Table.MIN_LEN_BAD) {\n        shameScore++;\n    }\n\n    if (data.pw.max <= Table.MAX_LEN_BAD) {\n        shameScore++;\n    }\n\n\n    for (let attr of Table.ATTRS) {\n        let $col = $row.find('.attr.' + attr);\n        let $attr;\n\n        if (!data.pw[attr]) {\n            $attr = $col.find('i.attr-false');\n        } else {\n            $attr = $col.find('i.attr-' + data.pw[attr]);\n        }\n\n        if ($attr && $attr.length) {\n            $attr.removeClass('hidden');\n            shameScore++;\n        }\n    }\n\n    if (data.scoreplus) {\n        shameScore += data.scoreplus;\n    }\n\n    // TODO: add comments in modal (?)\n    $row.find('.attr-score')\n        .text(shameScore)\n        .toggleClass('text-danger', shameScore >= Table.SHAME_SCORE_BAD);\n};\n","var PWoS = (function ($) {\n    const MAX_RESULTS = 30;\n\n    const DB_URL = 'data/db.json?v=' + PWOS_VERSION;\n\n    const $filters = $('.filter');\n    const table    = new Table($('#sites-list'), $('#site-template tr'));\n\n    let db;\n    let scrollMon;\n    let filters;\n    let results;\n    let $lazyInfo;\n    let $lazySpinner;\n\n\n    /**\n     * Filters the database using a filter input field.\n     */\n    function filter($input) {\n        let attr = $input.data('filter');\n        let val  = $input.val();\n\n        if (!attr || (val.length < 2 && val.length != 0)) {\n            return;\n        }\n\n        filters       = {};\n        filters[attr] = val;\n\n        getResults(filters);\n    }\n\n    /**\n     * Clears the table and fills it, filtering results (if passed).\n     */\n    function getResults(filter) {\n        filter  = filter || null;\n        results = db.filter(filter);\n\n        table.empty();\n        addResults();\n    }\n\n    /**\n     * Appends results to the current table\n     */\n    function addResults() {\n        if (!results) {\n            return;\n        }\n\n        let site   = results.next();\n        let count  = 0;\n\n        while (site && !site.done && site.value && count < MAX_RESULTS) {\n            table.addRow(site.value);\n            site = results.next();\n            count++;\n        }\n\n        $lazySpinner.addClass('hidden');\n        $lazyInfo.toggleClass('invisible', site.done);\n        $lazyInfo.toggleClass('invisible', site.done);\n\n        if (!site.done) {\n            scrollMon.start();\n        } else {\n            scrollMon.stop();\n        }\n    }\n\n\n    /**\n     * Initial setup (loading, table population).\n     */\n    function init() {\n        $('#last-update').text(new Date(PWOS_VERSION * 1000));\n\n        $('.filter').keypress(function (event) {\n            if (event.which == 13) {\n                filter($(this));\n            }\n        });\n\n        $(window).on('scrolled-to', function (event, $anchor) {\n            $lazySpinner.removeClass('hidden');\n            setTimeout(function () {\n                addResults();\n            }, 10)\n        });\n\n\n        $lazyInfo    = $('#lazy-loading-info');\n        $lazySpinner = $('#lazy-loading-spinner');\n        scrollMon    = new ScrollMonitor($('#lazy-loading-anchor'));\n\n\n        PWoSDb\n            .load(DB_URL)\n            .done(function (resultDb) {\n                db = resultDb;\n                getResults();\n            })\n            .fail(function () {\n                $lazySpinner.addClass('hidden');\n                $('#content').append($('<p>').addClass('alert alert-danger').text('Failed to load database'));\n            });\n    }\n\n\n    // public interface\n    return {\n        init: init\n    };\n})(jQuery);\n"]}